# iOS 기술 검토

### CallKit

- 전화 수신 확인이 가능한지?
  - 앱이 포그라운드일 경우 핸들러를 통해 다음 상태에 대해서 캐치 가능
    - CTCallStateDialing
    - CTCallStateIncoming
    - CTCallStateConnected
    - CTCallStateDisconnected
  - 앱이 백그라운드이거나 실행 중이 아닐 때에는 캐치 불가능
  - 다만 VoIP 전화일 경우 앱이 실행 중이 아니어도 캐치 가능
    - VoIP Push Notification을 이용해서 가능
    - 전화 건 사용자의 UUID, 설정된 유저 이름, 영상통화인지 아닌지 등 확인 가능

 

- 수신된 전화번호도 가능한지?
  - 일반 전화는 불가능
  - VoIP일 경우 수신된 사용자의 일부정보 확인 가능

 

- 기타 등등
  - iOS 8 부터 VoIP 기능이 있었지만 너무 제한적이었음
  - CallKit은 iOS 10부터 이용 가능 (특정 전화번호 블락 기능 추가, 특정 전화번호일 경우 이름 변환 기능 추가, VoIP 관련 기능 통합)
  - 수신 UI, 발신 UI 변경 불가능 (있는 그대로 사용해야함)

 

결국 VoIP가 아닌 전화번호로 수신된 전화에 대해서는 할 수 있는게 거의 없습니다.

일반 전화에 대해서 CallKit을 이용해서 가능한 부분은 [특정 전화번호 블락 기능 추가, 특정 전화번호일 경우 이름 변환] 이것 뿐일 듯 합니다.





### 스크린샷 기능 방지

iOS 에서 스크린샷 기능은 OS단에서 일어나는 것이기 때문에 스크린샷 기능 자체를 막는 것은 불가능합니다.
하지만 스크린샷 기능을 이용할 때를 캐치해서 화면에 다른 내용을 보여주어 보안을 유지하는 방법은 있습니다.
방법은 아래 두가지가 있습니다.

- UIApplication class 의 UIApplicationUserDidTakeScreenshotNotification으로 스크린샷을 감지
- 스크릿샷 기능을 사용할 때, 앱이 백그라운드로 진입하게 되는 점을 이용

구글링으로 조사해본 결과 주로 2번을 사용하는 것으로 보였습니다.
밑의 사이트는 2번을 이용한 예제입니다.
http://theultimatedeveloper.blogspot.kr/2013/03/how-to-disable-automatic-snapshot-in.html>

(2번은 스냅샷에 관한 보안 내용ㅋㅋ)





### 앱 실행 중이지 않을 때 위치체크

**앱이 백그라운드에서 실행 또는 앱이 실행 중이지 않아도 사용자의 위치정보가져오기 및 통신이 가능합니다.**
다만 해당 위임받은 기능이 작동되기 위해서는 바로 전에 찍힌 위치 값에서 **500미터 이상 멀어야하고** 최소 **5분 이상은 경과**되어야 한다고 합니다.

실제로는 500미터가 아닌 1km 정도는 되어야지 작동이 원활하게 작동되는 듯 합니다.

 그리고 사용자가 ‘**항상 허용**’을 체크해야지만 작동하도록 되어있습니다.



### CMPedometer 및 활동앱 기술 검토

CMPedometer을 이용하여 걸음수, 거리, 1초마다 간 거리(Cadence), 한걸음당 간 거리(Pace), 올라간 계단 수, 내려갈 계단 수를 구할 수 있으며,
위의 정보는 따로 계산한 값이 아니라 CMPedometer에서 직접 뽑아낸 값입니다.
OS 최소 지원 범위는 iOS 8.0 이상
해당 기능은 백그라운드, suspense상태에서도 작동하며 **앱이 종료되었을 때는 기록되지 않습니다.**



#### 종료 되었을 때도 기록하려면 다음을 이용

디바이스에 기록되는 ‘피트니스 활동’ 기록에 접근하여 데이터를 빼내는 방식으로 **가능합니다.** (시작일과 종료일을 입력하여 데이터 수집이 가능)

**앱이 실행 유무가 상관 없고 앱이 설치되기 전의 기록도 가져오는 것이 가능합니다.**

가져올 수 있는 데이터는 걸음 수, 거리, 1초마다 간 거리(Cadence), 한걸음당 간 거리(Pace), 올라간 계단 수, 내려갈 계단 수가 있습니다.

제약사항은 다음과 같습니다.

- 사용자의 피트니스 활동 접근 승인 필요 및 피트니스 기능 ON 여부
- 오늘로부터 7일 전의 데이터 수집 불가
- OS 최소 지원 범위는 iOS 8.0 이상



### 설정앱의 특정 화면으로 이동하기

iOS 와이파이 설정화면 이동은 알다시피 애플에서 공식 인터페이스를 열어주지 않았습니다.
그리고 설정앱의 원하는 특정 페이지로 이동하는 것도 불가능합니다.(설정앱의 메인 페이지도 불가능합니다.)
왜냐하면 애플에서 공식적으로 열어준 설정앱 이동 관련 인터페이스는 ‘UIApplicationOpenSettingsURLString’ 이라는 URL Scheme을 이용하여 여는 방법밖에 없습니다. 

(정말 이것 하나뿐입니다… 저두 왜 이렇게 게 철벽인지 모르겠습니다… private api를 이용하여 설정앱의 특정 페이지를 열게 할 수도 있는데 심사에서 리젝당하거나 최신 iOS버전에서 막히게 됩니다.)참고 사이트는 다음과 같습니다. (애플 공식 포럼 답변도 같이 기재되어 있습니다.)

<https://stackoverflow.com/questions/52214174/guide-user-to-wifi-setting-in-ios-devices>