# 넷마블 사전 과제

1. #### 현재 앱스토어에 등록되어 있는 '블레이드&소울 레볼루션 World' 앱을 본인이 개발한다고 가정하고, 앱 설계안을 작성하시오.

   - **대화방을 Design Pattern 적용해서 설계**

     유저 프로필, 대화방, 메시지 등의 객체들은 팩토리 메서드를 이용하여 객체 생성을 캡슐화하여 처리 합니다.
     대화방의 실시간 채팅에 대한 것은 소켓통신을 통해 구현을 하고 옵져버 패턴을 이용하여 소켓통신에서 응답이 올 때마다 UI를 업데이트 합니다.

     

   - ##### **사용자 인터렉션(반응성)을 고려한 Thread 설계**

     사용자가 버튼을 눌러 이벤트(페이지 로드, 통신)을 발생시켰을 때, 같은 버튼을 여러번 눌러 중복으로 이벤트를 발생시키지 않도록 특정 시간만큼 throttling 해줍니다.
     이벤트를 로드하는 중이라도 사용자의 인터렉션을 중단 시키지 않도록 이벤트는 비동기적으로 처리하고 이벤트가 여러개가 쌓인다면 큐에 넣고 순차적으로 이벤트를 처리한다.

     

   - **대화 메시지에 캐싱에 대한 구조 설계**

     대화 메시지가 도착하면 바로 캐싱을 하여 내부 스토리지에 저장을 하고 만료일을 정하여 기한을 넘긴 메시지는 로드되지 않도록 한다.
     만료일을 체크하여 해당 메시지를 지우는 시점은 해당 대화방을 로드하는 시점에 수행하도록 한다.

     

   - **읽지 않은 메시지 개수가 10,000개 일 때 효과적으로 조회하는 방법**

     최근 메시지 100개 정도를 먼저 조회한 다음에 사용자가 그 이전 메시지를 조회하려는 경우 다시 100개의 메시지를 불러들이도록 동적 로드 방식을 취합니다.

     

2. #### 최근에 공부한 기술적인 주제에 대해 간략히 소개하시오.

   **Swift5 주요 변경점**

    - ABI Stability

      ABI란 Application Binary Interface로서 OS에서 해당 앱을 구동시키기 위한 인터페이스인데 
      이것이 Swift5에 와서 안정화가 되었습니다. 
      년마다 업데이트 되던 Swift 언어가 ABI Stability가 되면서 얻는 이점은 다음과 같습니다.

      - 번들 사이즈 감소

        Swift로 빌드된 앱은 Obj-C로 빌드된 앱보다 용량이 컸습니다(empty 프로젝트를 빌드했을 때 OBJ-C는 3MB, Swift는 8MB)

        그 이유는 OS 상에 해당 언어의 Binary Interface가 내장되어 있지 않고 앱에 동봉되어 왔기 때문인데 
        iOS 12에 와서 해결되었습니다. 

        하지만 타겟 버전을 iOS 12로 빌드를해야하기 때문에 아직 먼 이야기입니다.

      - 언어 변경 사항 감소 

        안정화가 되었기 때문에 앞으로 크게 바뀌지 않습니다.

      - Swift Pre-compiled Framework Stability

        Swift5 이전 프레임워크들은 프로젝트를 빌드할 때 마다 매번 프레임워크도 같이 빌드를 해줬어야 했습니다.

        왜냐하면 프레임워크랑 프로젝트가 Swift 버전이 서로 다르면 Linking이 되지 않았기 때문인데, Swift5로 컴파일 된 프레임워크는 앞으로 나올 Swift5 이상 프로젝트에서도 이용 가능하게 됬습니다.

    - Async/Await Pattern

      언어 트랜드에 맞추어 파이썬이나 자바스크립에서 많이 볼 수 있었던 Async/Await Pattern이 추가되었습니다.
      이로 인해 콜백지옥에서 쉽게 빠져나올 수 있게 되었습니다.

   

   **최근 CallKit에 대해서 기술검토 했던 내용이 있어서 첨부드립니다.**

   - 전화 수신 확인이 가능한지?
     - 앱이 포그라운드일 경우 핸들러를 통해 다음 상태에 대해서 캐치 가능
       - CTCallStateDialing
       - CTCallStateIncoming
       - CTCallStateConnected
       - CTCallStateDisconnected
     - 앱이 백그라운드이거나 실행 중이 아닐 때에는 캐치 불가능
     - 다만 VoIP 전화일 경우 앱이 실행 중이 아니어도 캐치 가능
       - VoIP Push Notification을 이용해서 가능
       - 전화 건 사용자의 UUID, 설정된 유저 이름, 영상통화인지 아닌지 등 확인 가능

    

   - 수신된 전화번호도 가능한지?
     - 일반 전화는 불가능
     - VoIP일 경우 수신된 사용자의 일부정보 확인 가능

    

   - 기타 등등
     - iOS 8 부터 VoIP 기능이 있었지만 너무 제한적이었음
     - CallKit은 iOS 10부터 이용 가능 (특정 전화번호 블락 기능 추가, 특정 전화번호일 경우 이름 변환 기능 추가, VoIP 관련 기능 통합)
     - 수신 UI, 발신 UI 변경 불가능 (있는 그대로 사용해야함)

    

   결국 VoIP가 아닌 전화번호로 수신된 전화에 대해서는 할 수 있는게 거의 없습니다.
   일반 전화에 대해서 CallKit을 이용해서 가능한 부분은 [특정 전화번호 블락 기능 추가, 특정 전화번호일 경우 이름 변환] 이것 뿐일 듯 합니다.
